<!doctype html>
<html>
    <head>
        <meta charset="UTF-8" />
        <title>hello phaser!</title>
        <script src="//cdn.jsdelivr.net/phaser/2.5.0/phaser.min.js"></script>
    </head>
    <body>

    <script type="text/javascript">

    window.onload = function() {

        //  Note that this html file is set to pull down Phaser 2.5.0 from the JS Delivr CDN.
        //  Although it will work fine with this tutorial, it's almost certainly not the most current version.
        //  Be sure to replace it with an updated version before you start experimenting with adding your own code.
        
        
        var game = new Phaser.Game(800, 600, Phaser.AUTO, '', { preload: preload, create: create, update: update });
        
        function preload () {
            game.stage.backgroundColor = '#85b5e1';
            game.load.baseURL = 'http://examples.phaser.io/assets/';
            game.load.crossOrigin = 'anonymous';
            game.load.image('player', 'sprites/phaser-dude.png');
            game.load.image('teammate', 'sprites/phaser-dude.png');
            game.load.image('player2', 'sprites/slime.png');
            game.load.image('platform', 'sprites/platform.png');
        }
        var player;
        var player2;
        var teammate;
        var teammate2;
        var platforms;
        var cursors;
        var jumpButton;
        var line;

        function create() {
            
            teammate2 = game.add.sprite(game.world.width*0.35 - 100, game.world.height*0.82, 'teammate');
            player2 = game.add.sprite(game.world.width*0.65, game.world.height*0.81, 'player2');
            
            line = new Phaser.Line(teammate2.x+100, teammate2.y*0.5, player2.x-100, player2.y*0.5);
            
            player = game.add.sprite(game.world.width*0.35, game.world.height*0.82, 'player');
            teammate = game.add.sprite(game.world.width*0.35 - 50, game.world.height*0.82, 'teammate');
            
            //var graphics=game.add.graphics(teammate2.x, teammate2.y);
            //graphics.lineStyle(2, 0xffffff, 1);
            //graphics.lineTo(player2.x, player2.x);
            //graphics.endFill();
            
            game.physics.arcade.enable(player);
            game.physics.arcade.enable(player2);
            game.physics.arcade.enable(teammate);
            game.physics.arcade.enable(teammate2);

            player.body.collideWorldBounds = true;
            player.body.gravity.y = 500;

            teammate.body.collideWorldBounds = true;
            teammate.body.gravity.y = 500;

            teammate2.body.collideWorldBounds = true;
            teammate2.body.gravity.y = 500;

            player2.body.collideWorldBounds = true;
            player2.body.gravity.y = 500;

            platforms = game.add.physicsGroup();
            platforms.create(0, game.world.height*0.9, 'platform'); 
            platforms.create(game.world.width*0.5,game.world.height*0.9,'platform'); 

            platforms.setAll('body.immovable', true);

            cursors = game.input.keyboard.createCursorKeys();
            jumpButton = game.input.keyboard.addKey(Phaser.Keyboard.SPACEBAR);

        }
        var flipFlop;
        var xVel = 50;
        var tugVel = -900;
        var start = true;
        
        function update () {
            game.debug.geom(line);
            //game.debug.lineInfo(line, 32, 32);
            
            
            
            game.physics.arcade.collide(player, platforms);
            game.physics.arcade.collide(player2, platforms);
            game.physics.arcade.collide(teammate, platforms);
            game.physics.arcade.collide(teammate2, platforms);
            
            player.body.velocity.x = xVel;
            teammate.body.velocity.x = xVel;
            player2.body.velocity.x = xVel;
            teammate2.body.velocity.x = xVel;
            line.setTo(teammate2.x, teammate2.y+20, player2.x+10, player2.y+20);
            if (teammate2.body.position.x <= 0 || player2.body.position.x >= game.world.width*0.93) {
                xVel = 0;
                tugVel = 0;
            } 
            if (cursors.left.isDown){
                    if (!flipFlop) {
                        player.body.velocity.x = tugVel;
                        teammate.body.velocity.x = tugVel;
                        player2.body.velocity.x = tugVel;
                        teammate2.body.velocity.x = tugVel;
                        player.animations.stop('move');
                        teammate.animations.stop('move');
                        player2.animations.stop('move');
                        teammate2.animations.stop('move');
                        flipFlop = true;
                    }
                }

            if (cursors.left.isUp) {
                    flipFlop = false;
            }
        }
    };

    </script>

    </body>
</html>